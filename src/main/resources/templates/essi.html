<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8"/>
        <title>LIPUT</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>    
    </head>
    
<body>
 
<div class="container">
 
  
  <div>
    <form class="form-inline">

      <div class="form-group">
        <label for="code" style="margin-left:20px; margin-right:5px">Ticketcode:</label>
        <input type="text" class="form-control" id="code" placeholder="Ticket code in UUID form"/>
        <!--ECLIPSEN KONSOLIIN TULOSTUU TESTILIPPUKOODI OHJELMAN KÄYNNISTYESSÄ -->
      </div>      
      <button id="getTicket" type="button" class="btn btn-primary">Hae lipun tiedot</button>
       <button id="useTicket" type="button" class="btn btn-primary">Käytä lippu</button>     
    </form>
  </div>
  
  <div class="col-sm-7" id="result">
  </div>
 
  
</div>



<script type="text/javascript">
	 
			 
			 $( document ).ready(function() {
				  
				  // Kun painetaan submit
				  $("#getTicket").click(function(event){
				    event.preventDefault();
				    ajaxGet();
				  });

				  $("#useTicket").click(function(event){
					    event.preventDefault();
					    ajaxPatch();
					  });
					  
				
			
				  
			 
			  function ajaxGet(){
				  
				     var ticketcode = $("#code").val();

				  
				    $.ajax({
						type: "GET",
				        dataType: "json",						
				 		headers: {"Authorization": "Basic " + btoa("niilo" + ":" + "salasana")},
						url : "http://localhost:8080/api/tickets/" + ticketcode,
						success: function(result){
				          $('#result').empty();				          
				          $("#result").html("<p> Tapahtuma:" +result.event.name+ "<br> Lippukoodi:" + result.ticketcode + "<br> Lipputyyppi: "+ result.type.type+ "<br> Hinta: " +result.price+ "</p>");
				          console.log(result);	        
				      },
				      
				      error : function(e) {
				        $("#result").html("Virhe");
				        console.log("Virhe: ", e);
				      }
				    });  
				    
				    $("#code").val("");  
				    
				  }
			  
			  
			  function ajaxPatch(){
				  
				     var ticketcode = $("#code").val();

				  
				    $.ajax({
						type: "PATCH",
				        dataType: "json",						
				 		headers: {"Authorization": "Basic " + btoa("niilo" + ":" + "salasana")},
						url : "http://localhost:8080/api/tickets/read/" + ticketcode,
						
						success: function(result){
				          $('#result').empty();				          
				          $("#result").html(result);
				          console.log(result);	        
				      },
				      
				      error : function(e) {
				        $("#result").html("Virhe");
				        console.log("Virhe: ", e);
				      }
				    });  
				    
				    $("#code").val("");  
				    
				  }
			  
			  
			  
			  
			  
				})


</script>
</body>
</html>
